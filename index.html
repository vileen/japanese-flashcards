<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B6B">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Êó•Êú¨Ë™ûÂ≠¶Áøí">
    <title>Japanese Flashcards</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" id="dark-mode-toggle" aria-label="Toggle dark mode">
        <span class="dark-mode-icon"></span>
    </button>

    <!-- Main Menu Screen -->
    <div id="main-menu" class="screen active">
        <div class="header">
            <h1>Êó•Êú¨Ë™ûÂ≠¶Áøí</h1>
            <p class="subtitle">Japanese Learning System</p>
        </div>
        
        <div class="menu-cards">
            <div class="menu-card" data-system="hiragana">
                <div class="menu-card-main">
                    <h2>„Å≤„Çâ„Åå„Å™</h2>
                    <p class="system-name">Hiragana</p>
                </div>
                <div class="progress-info">
                    <div class="stat">
                        <span class="stat-label">‚òë</span>
                        <span class="stat-value" id="hiragana-selected">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">‚úì</span>
                        <span class="stat-value" id="hiragana-success">0%</span>
                    </div>
                </div>
            </div>

            <div class="menu-card" data-system="katakana">
                <div class="menu-card-main">
                    <h2>„Ç´„Çø„Ç´„Éä</h2>
                    <p class="system-name">Katakana</p>
                </div>
                <div class="progress-info">
                    <div class="stat">
                        <span class="stat-label">‚òë</span>
                        <span class="stat-value" id="katakana-selected">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">‚úì</span>
                        <span class="stat-value" id="katakana-success">0%</span>
                    </div>
                </div>
            </div>

            <div class="menu-card" data-system="kanji">
                <div class="menu-card-main">
                    <h2>Êº¢Â≠ó</h2>
                    <p class="system-name">Kanji</p>
                </div>
                <div class="progress-info">
                    <div class="stat">
                        <span class="stat-label">‚òë</span>
                        <span class="stat-value" id="kanji-selected">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">‚úì</span>
                        <span class="stat-value" id="kanji-success">0%</span>
                    </div>
                </div>
            </div>

            <div class="menu-card" data-system="vocabulary">
                <div class="menu-card-main">
                    <h2>Ë™ûÂΩô</h2>
                    <p class="system-name">Vocabulary</p>
                </div>
                <div class="progress-info">
                    <div class="stat">
                        <span class="stat-label">üìö</span>
                        <span class="stat-value" id="vocabulary-selected">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">‚úì</span>
                        <span class="stat-value" id="vocabulary-success">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SRS Statistics -->
        <div class="srs-stats" id="srs-stats">
            <div class="srs-stat-card">
                <div class="srs-stat-value" id="srs-due">0</div>
                <div class="srs-stat-label">Due Today</div>
            </div>
            <div class="srs-stat-card">
                <div class="srs-stat-value" id="srs-new">0</div>
                <div class="srs-stat-label">New</div>
            </div>
            <div class="srs-stat-card">
                <div class="srs-stat-value" id="srs-learning">0</div>
                <div class="srs-stat-label">Learning</div>
            </div>
        </div>

        <div class="practice-buttons">
            <button class="practice-btn primary-btn" id="start-review">
                üìö Review
            </button>
            
            <button class="practice-btn secondary-btn" id="start-practice">
                üéØ Practice
            </button>
        </div>
    </div>

    <!-- Character Selection Screen -->
    <div id="character-selection" class="screen">
        <div class="header">
            <button class="back-btn" id="back-to-menu">‚Üê</button>
            <h2 id="selection-title">Hiragana</h2>
        </div>

        <div class="selection-controls">
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">All</button>
                <button class="filter-tab" data-filter="selected">Selected</button>
                <button class="filter-tab" data-filter="unlearned">Need Practice</button>
            </div>
            <button class="select-all-btn" id="toggle-all">Select All</button>
        </div>

        <div class="character-grid" id="character-grid">
            <!-- Characters will be dynamically loaded here -->
        </div>

        <div class="bottom-bar">
            <div class="selected-count">
                <span id="selected-count">0 selected</span>
            </div>
        </div>
    </div>

    <!-- Vocabulary Management Screen -->
    <div id="vocabulary-management" class="screen">
        <div class="header">
            <div>
                <button class="back-btn" id="back-from-vocabulary">‚Üê</button>
                <h2>Vocabulary Management</h2>
            </div>
            
            <div class="sync-status" id="sync-status">üì± Offline</div>
            
            <div class="header-actions">
                <button class="share-btn" id="share-vocabulary-btn">üîó Share</button>
                <button class="add-btn" id="add-vocabulary-btn">+ Add</button>
            </div>
        </div>

        <div class="vocabulary-controls">
            <div class="search-bar">
                <input type="text" id="vocabulary-search" placeholder="Search vocabulary..." />
            </div>
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">All</button>
                <button class="filter-tab" data-filter="category">By Category</button>
            </div>
        </div>

        <div class="vocabulary-list" id="vocabulary-list">
            <!-- Vocabulary words will be dynamically loaded here -->
        </div>

        <div class="bottom-bar">
            <div class="vocabulary-stats">
                <span id="vocabulary-count">0 words</span>
            </div>
            <button class="practice-btn primary-btn" id="start-vocabulary-practice">
                Practice All
            </button>
        </div>
    </div>

    <!-- Add/Edit Vocabulary Modal -->
    <div class="modal-overlay" id="vocabulary-modal" style="display: none;">
        <div class="modal-content vocabulary-form">
            <div class="modal-header">
                <h3 id="vocabulary-modal-title">Add Vocabulary</h3>
                <button class="close-btn" id="close-vocabulary-modal">√ó</button>
            </div>
            
            <form id="vocabulary-form">
                <div class="form-group">
                    <label for="vocab-english">English</label>
                    <input type="text" id="vocab-english" required placeholder="Enter English word/phrase">
                </div>
                
                <div class="form-group">
                    <label for="vocab-romaji">Romaji</label>
                    <input type="text" id="vocab-romaji" required placeholder="Enter romaji pronunciation">
                </div>
                
                <div class="form-group">
                    <label for="vocab-hiragana">Hiragana</label>
                    <input type="text" id="vocab-hiragana" placeholder="„Å≤„Çâ„Åå„Å™ (auto-filled from romaji)">
                </div>
                
                <div class="form-group">
                    <label for="vocab-katakana">Katakana</label>
                    <input type="text" id="vocab-katakana" placeholder="„Ç´„Çø„Ç´„Éä (auto-filled from romaji)">
                </div>
                
                <div class="form-group">
                    <label for="vocab-kanji">Kanji</label>
                    <input type="text" id="vocab-kanji" placeholder="Êº¢Â≠ó (optional)">
                </div>
                
                <div class="form-group">
                    <label for="vocab-meaning">Meaning/Notes</label>
                    <input type="text" id="vocab-meaning" placeholder="Additional context (optional)">
                </div>
                
                <div class="form-group">
                    <label for="vocab-category">Category</label>
                    <select id="vocab-category">
                        <option value="general">General</option>
                        <option value="greetings">Greetings</option>
                        <option value="family">Family</option>
                        <option value="food">Food</option>
                        <option value="animals">Animals</option>
                        <option value="colors">Colors</option>
                        <option value="numbers">Numbers</option>
                        <option value="time">Time</option>
                        <option value="weather">Weather</option>
                        <option value="body">Body</option>
                        <option value="clothing">Clothing</option>
                        <option value="transportation">Transportation</option>
                        <option value="school">School</option>
                        <option value="work">Work</option>
                        <option value="hobbies">Hobbies</option>
                        <option value="emotions">Emotions</option>
                        <option value="adjectives">Adjectives</option>
                        <option value="verbs">Verbs</option>
                        <option value="nouns">Nouns</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="secondary-btn" id="cancel-vocabulary">Cancel</button>
                    <button type="submit" class="primary-btn" id="save-vocabulary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Practice Mode Selection -->
    <div id="mode-selection" class="screen">
        <div class="header">
            <button class="back-btn" id="back-from-mode">‚Üê</button>
            <h2>Choose Practice Mode</h2>
        </div>

        <div class="mode-cards">
            <div class="mode-card" id="multiple-choice-mode">
                <div class="mode-icon">üìù</div>
                <h3>Multiple Choice</h3>
                <p>Test your knowledge with 3 options. Character ‚áÑ Romaji</p>
            </div>

            <div class="mode-card" id="flashcard-mode">
                <div class="mode-icon">üé¥</div>
                <h3>Flashcard</h3>
                <p>Reveal and self-assess your understanding</p>
            </div>

            <div class="mode-card" id="vocabulary-practice-mode">
                <div class="mode-icon">üìö</div>
                <h3>Vocabulary Practice</h3>
                <p>Practice vocabulary words with English ‚áÑ Japanese flashcards</p>
            </div>
        </div>
    </div>

    <!-- Multiple Choice Practice Screen -->
    <div id="practice-multiple" class="screen">
        <div class="practice-header">
            <button class="back-btn" id="back-from-practice">‚Üê</button>
            <div class="practice-progress">
                <span id="current-question">1</span>/<span id="total-questions">10</span>
            </div>
            <div class="practice-score" id="practice-score">0%</div>
        </div>

        <div class="practice-container">
            <div class="question-card">
                <div class="question-type" id="question-type">Character ‚Üí Romaji</div>
                <div class="question-display" id="question-display">„ÅÇ</div>
            </div>

            <div class="options-container" id="options-container">
                <!-- Options will be dynamically generated -->
            </div>
        </div>

        <button class="next-btn" id="next-question" style="display: none;">Next</button>
    </div>

    <!-- Flashcard Practice Screen -->
    <div id="practice-flashcard" class="screen">
        <div class="practice-header">
            <button class="back-btn" id="back-from-flashcard">‚Üê</button>
            <div class="practice-progress">
                <span id="flashcard-current">1</span>/<span id="flashcard-total">10</span>
            </div>
            <div class="practice-score" id="flashcard-score">0%</div>
        </div>

        <div class="flashcard-container">
            <div class="flashcard" id="flashcard">
                <div class="flashcard-front">
                    <div class="flashcard-label">Character</div>
                    <div class="flashcard-character" id="flashcard-character">„ÅÇ</div>
                </div>
                <div class="flashcard-back" id="flashcard-back">
                    <div class="flashcard-label">Romaji</div>
                    <div class="flashcard-answer" id="flashcard-answer">a</div>
                </div>
                <div class="tap-hint" id="tap-hint">Tap to reveal</div>
                
                <div class="flashcard-controls" id="flashcard-controls" style="display: none;">
                    <button class="assess-btn wrong-btn" id="assess-wrong">Need Practice</button>
                    <button class="assess-btn correct-btn" id="assess-correct">Got It!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SRS Review Screen -->
    <div id="practice-review" class="screen">
        <div class="practice-header">
            <button class="back-btn" id="back-from-review">‚Üê</button>
            <div class="practice-progress">
                <span id="review-current">1</span>/<span id="review-total">10</span>
            </div>
            <div class="practice-score" id="review-score">0%</div>
        </div>

        <div class="flashcard-container">
            <div class="flashcard" id="review-card">
                <div class="flashcard-front">
                    <div class="flashcard-label">Character</div>
                    <div class="flashcard-character" id="review-character">„ÅÇ</div>
                </div>
                <div class="flashcard-back" id="review-back">
                    <div class="flashcard-label">Romaji</div>
                    <div class="flashcard-answer" id="review-answer">a</div>
                </div>
                <div class="tap-hint" id="review-hint">Tap to reveal</div>
            </div>

            <div class="review-controls" id="review-controls" style="display: none;">
                <button class="quality-btn again-btn" id="quality-again">
                    <span class="quality-time">10m</span>
                    <span class="quality-label">Again</span>
                </button>
                <button class="quality-btn hard-btn" id="quality-hard">
                    <span class="quality-time">1d</span>
                    <span class="quality-label">Hard</span>
                </button>
                <button class="quality-btn good-btn" id="quality-good">
                    <span class="quality-time">3d</span>
                    <span class="quality-label">Good</span>
                </button>
                <button class="quality-btn easy-btn" id="quality-easy">
                    <span class="quality-time">7d</span>
                    <span class="quality-label">Easy</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Vocabulary Practice Screen -->
    <div id="practice-vocabulary" class="screen">
        <div class="practice-header">
            <button class="back-btn" id="back-from-vocabulary-practice">‚Üê</button>
            <div class="practice-progress">
                <span id="vocabulary-practice-current">1</span>/<span id="vocabulary-practice-total">10</span>
            </div>
            <div class="practice-score" id="vocabulary-practice-score">0%</div>
        </div>

        <div class="flashcard-container">
            <div class="flashcard" id="vocabulary-flashcard">
                <div class="vocabulary-category-display">
                    <span id="vocabulary-category">Category</span>
                </div>
                
                <div class="flashcard-front">
                    <div class="flashcard-label" id="vocabulary-flashcard-front-label">English</div>
                    <div class="flashcard-character" id="vocabulary-flashcard-front">hello</div>
                </div>
                <div class="flashcard-back" id="vocabulary-flashcard-back-section">
                    <div class="flashcard-label" id="vocabulary-flashcard-back-label">Japanese</div>
                    <div class="flashcard-answer" id="vocabulary-flashcard-back">„Åì„Çì„Å´„Å°„ÅØ</div>
                    <div class="flashcard-additional" id="vocabulary-flashcard-additional">konnichiwa</div>
                </div>
                <div class="tap-hint" id="vocabulary-tap-hint">Tap to reveal</div>
                
                <div class="flashcard-controls" id="vocabulary-flashcard-controls" style="display: none;">
                    <button class="assess-btn wrong-btn" id="vocabulary-assess-wrong">Need Practice</button>
                    <button class="assess-btn correct-btn" id="vocabulary-assess-correct">Got It!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results" class="screen">
        <div class="header">
            <h2>Practice Complete!</h2>
        </div>

        <div class="results-container">
            <div class="results-score">
                <div class="score-circle">
                    <span id="final-score">85%</span>
                </div>
                <p class="score-label">Success Rate</p>
            </div>

            <div class="results-stats">
                <div class="result-stat">
                    <span class="result-value" id="correct-count">17</span>
                    <span class="result-label">Correct</span>
                </div>
                <div class="result-stat">
                    <span class="result-value" id="total-count">20</span>
                    <span class="result-label">Total</span>
                </div>
            </div>

            <div class="results-actions">
                <button class="secondary-btn" id="practice-again">Practice Again</button>
                <button class="primary-btn" id="back-to-main">Back to Menu</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div class="modal-overlay" id="alert-modal" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title" id="alert-title">Alert</h3>
            <p class="modal-message" id="alert-message">Message</p>
            <button class="primary-btn" id="alert-ok">OK</button>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div class="modal-overlay" id="confirm-modal" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title" id="confirm-title">Confirm</h3>
            <p class="modal-message" id="confirm-message">Are you sure?</p>
            <div class="modal-actions">
                <button class="secondary-btn" id="confirm-cancel">Cancel</button>
                <button class="primary-btn" id="confirm-ok">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Sharing Modal -->
    <div class="modal-overlay" id="sharing-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Share Vocabulary Across Devices</h3>
                <button class="close-btn" id="close-sharing-modal">√ó</button>
            </div>
            
            <div class="sharing-content">
                <div class="current-id-section">
                    <h4>Your Device ID</h4>
                    <div class="user-id-display">
                        <span id="current-user-id">XXXXXXXX</span>
                        <button class="copy-btn" id="copy-user-id">Copy</button>
                    </div>
                    <p class="help-text">Share this ID with your other devices to sync vocabulary</p>
                    
                    <div id="joined-id-display" style="display: none;">
                        <p class="help-text">Currently using shared ID: <strong id="joined-id"></strong></p>
                    </div>
                    
                </div>
                
                <div class="join-section">
                    <h4>Join Another Device</h4>
                    <div class="join-form">
                        <input type="text" id="join-user-id" placeholder="Enter 8-character ID" maxlength="8">
                        <button class="primary-btn" id="join-user-btn">Join</button>
                    </div>
                    <p class="help-text">Enter an ID from another device to access its vocabulary</p>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="secondary-btn" id="cancel-sharing">Close</button>
            </div>
        </div>
    </div>

    <!-- Wanakana library for romaji conversion -->
    <script src="https://unpkg.com/wanakana"></script>
    
    <!-- Firebase SDK v9+ -->
    <script type="module" src="js/firebase-modern.js"></script>
    
    <script src="js/data.js"></script>
    <script src="js/vocabulary.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/srs.js"></script>
    <script src="js/practice.js"></script>
    <script src="js/shared-user.js"></script>
    <script src="js/vocabulary-ui.js"></script>
    <script src="js/vocabulary-practice.js"></script>
    <script src="js/app-core.js"></script>
    <script src="js/navigation.js"></script>
</body>
</html>
